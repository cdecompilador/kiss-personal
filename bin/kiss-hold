#!/bin/sh

# Easy way to 'hold' packages at a specified version, just make
# "$HOME/.cache/kiss/hold/" the first repo in your KISS_PATH.

for arg in "$@"; do
    case "$arg" in
        -d) delete=1;;
        *) pkg="$arg";;
    esac
done

[ -z "$pkg" ] && exit 1

pkg_id="${KISS_ROOT:-/}var/db/kiss/installed/$pkg/"

kiss_hold_repo="${XDG_CACHE_DIR:-$HOME/.cache}/kiss/hold/"

[ -d "$kiss_hold_repo" ] || mkdir -pv "$kiss_hold_repo"

if [ -d "$pkg_id" ]; then
    cp -r "$pkg_id" "$kiss_hold_repo"
fi

if [ "$delete" = 1 ]; then
    rm -rf -- "${kiss_hold_repo}${pkg}"
fi
