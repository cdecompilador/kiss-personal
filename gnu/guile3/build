#!/bin/sh -e

: > nostrip

# remove tests that don't pass with musl libc.
# most of them fail because musl only supports UTF-8.
rm -f \
    ./test-suite/tests/time.test \
    ./test-suite/tests/encoding-escapes.test \
    ./test-suite/tests/i18n.test \
    ./test-suite/tests/encoding-iso88597.test \
    ./test-suite/tests/iconv.test \
    ./test-suite/tests/suspendable-ports.test \
    ./test-suite/tests/r6rs-ports.test

for p in *.patch; do
    patch -p1 < "$p"
done

./configure \
    --prefix=/usr \
    --program-suffix=3 \
    --enable-posix \
    --disable-error-on-warning \
    --disable-lto \
    --disable-rpath

make
make check
make install
